import { __decorate, __extends, __metadata } from "tslib";
import { EventEmitter, Injectable, NgZone, OnDestroy } from '@angular/core';
import { HttpClient, HttpRequest, HttpResponse } from '@angular/common/http';
import { KeepaliveSvc } from '@ng-idle/core';
/**
 * An example of an injectable service.
 */
var Keepalive = /** @class */ (function (_super) {
    __extends(Keepalive, _super);
    /*
     * Initializes a new instance of Keepalive
     * @param http - The HTTP service.
     */
    function Keepalive(http, zone) {
        var _this = _super.call(this) || this;
        _this.http = http;
        _this.zone = zone;
        _this.pingInterval = 10 * 60;
        /*
         * An event emitted when the service is pinging.
         */
        _this.onPing = new EventEmitter();
        /*
         * An event emitted when the service has pinged an HTTP endpoint and received a response.
         */
        _this.onPingResponse = new EventEmitter();
        return _this;
    }
    /*
     * Sets the string or Request that should be used when pinging.
     * @param url - The URL or Request object to use when pinging.
     * @return The current Request used when pinging.
     */
    Keepalive.prototype.request = function (url) {
        if (typeof url === 'string') {
            this.pingRequest = new HttpRequest('GET', url);
        }
        else if (url instanceof HttpRequest) {
            this.pingRequest = url;
        }
        else if (url === null) {
            this.pingRequest = null;
        }
        return this.pingRequest;
    };
    /*
     * Sets the interval (in seconds) at which the ping operation will occur when start() is called.
     * @param seconds - The ping interval in seconds.
     * @return The current interval value.
     */
    Keepalive.prototype.interval = function (seconds) {
        if (!isNaN(seconds) && seconds > 0) {
            this.pingInterval = seconds;
        }
        else if (!isNaN(seconds) && seconds <= 0) {
            throw new Error('Interval value must be greater than zero.');
        }
        return this.pingInterval;
    };
    /*
     * Immediately performs the ping operation. If a request has been set, an HTTP
     * request will be made and the response will be emitted via the
     * onPingResponse event.
     */
    Keepalive.prototype.ping = function () {
        var _this = this;
        this.onPing.emit(null);
        if (this.pingRequest) {
            this.http.request(this.pingRequest).subscribe(function (response) {
                _this.onPingResponse.emit(response);
            }, function (error) {
                _this.onPingResponse.emit(error);
            });
        }
    };
    /*
     * Starts pinging on an interval.
     */
    Keepalive.prototype.start = function () {
        var _this = this;
        this.stop();
        this.zone.runOutsideAngular(function () {
            _this.pingHandle = setInterval(function () {
                _this.zone.run(function () {
                    _this.ping();
                });
            }, _this.pingInterval * 1000);
        });
    };
    /*
     * Stops pinging on an interval.
     */
    Keepalive.prototype.stop = function () {
        if (this.hasPingHandle()) {
            clearInterval(this.pingHandle);
            this.pingHandle = null;
        }
    };
    /*
     * Performs any cleanup tasks when Angular destroys the instance.
     */
    Keepalive.prototype.ngOnDestroy = function () {
        this.stop();
    };
    /*
     * Returns whether or not the service will ping automatically at the specified interval.
     * @return True if the service will ping at the specified interval; otherwise, false.
     */
    Keepalive.prototype.isRunning = function () {
        return this.hasPingHandle();
    };
    Keepalive.prototype.hasPingHandle = function () {
        return this.pingHandle !== null && typeof this.pingHandle !== 'undefined';
    };
    Keepalive.ctorParameters = function () { return [
        { type: HttpClient },
        { type: NgZone }
    ]; };
    Keepalive = __decorate([
        Injectable(),
        __metadata("design:paramtypes", [HttpClient, NgZone])
    ], Keepalive);
    return Keepalive;
}(KeepaliveSvc));
export { Keepalive };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2VlcGFsaXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQG5nLWlkbGUva2VlcGFsaXZlLyIsInNvdXJjZXMiOlsibGliL2tlZXBhbGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1RSxPQUFPLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUM3RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTdDOztHQUVHO0FBRUg7SUFBK0IsNkJBQVk7SUFpQnpDOzs7T0FHRztJQUNILG1CQUFvQixJQUFnQixFQUFVLElBQVk7UUFBMUQsWUFDRSxpQkFBTyxTQUNSO1FBRm1CLFVBQUksR0FBSixJQUFJLENBQVk7UUFBVSxVQUFJLEdBQUosSUFBSSxDQUFRO1FBbkJsRCxrQkFBWSxHQUFXLEVBQUUsR0FBRyxFQUFFLENBQUM7UUFHdkM7O1dBRUc7UUFDSSxZQUFNLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFFdEQ7O1dBRUc7UUFDSSxvQkFBYyxHQUFvQyxJQUFJLFlBQVksRUFFdEUsQ0FBQzs7SUFRSixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILDJCQUFPLEdBQVAsVUFBVyxHQUE2QjtRQUN0QyxJQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVEsRUFBRTtZQUMzQixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksV0FBVyxDQUFJLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztTQUNuRDthQUFNLElBQUksR0FBRyxZQUFZLFdBQVcsRUFBRTtZQUNyQyxJQUFJLENBQUMsV0FBVyxHQUFHLEdBQUcsQ0FBQztTQUN4QjthQUFNLElBQUksR0FBRyxLQUFLLElBQUksRUFBRTtZQUN2QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztTQUN6QjtRQUVELE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQztJQUMxQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILDRCQUFRLEdBQVIsVUFBUyxPQUFnQjtRQUN2QixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLE9BQU8sR0FBRyxDQUFDLEVBQUU7WUFDbEMsSUFBSSxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUM7U0FDN0I7YUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLE9BQU8sSUFBSSxDQUFDLEVBQUU7WUFDMUMsTUFBTSxJQUFJLEtBQUssQ0FBQywyQ0FBMkMsQ0FBQyxDQUFDO1NBQzlEO1FBRUQsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBQzNCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsd0JBQUksR0FBSjtRQUFBLGlCQVlDO1FBWEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkIsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLENBQzNDLFVBQUMsUUFBMkI7Z0JBQzFCLEtBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3JDLENBQUMsRUFDRCxVQUFDLEtBQXdCO2dCQUN2QixLQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNsQyxDQUFDLENBQ0YsQ0FBQztTQUNIO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gseUJBQUssR0FBTDtRQUFBLGlCQVVDO1FBVEMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBRVosSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztZQUMxQixLQUFJLENBQUMsVUFBVSxHQUFHLFdBQVcsQ0FBQztnQkFDNUIsS0FBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7b0JBQ1osS0FBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNkLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxFQUFFLEtBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQ7O09BRUc7SUFDSCx3QkFBSSxHQUFKO1FBQ0UsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFLEVBQUU7WUFDeEIsYUFBYSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUMvQixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztTQUN4QjtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILCtCQUFXLEdBQVg7UUFDRSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDZCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsNkJBQVMsR0FBVDtRQUNFLE9BQU8sSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQzlCLENBQUM7SUFFTyxpQ0FBYSxHQUFyQjtRQUNFLE9BQU8sSUFBSSxDQUFDLFVBQVUsS0FBSyxJQUFJLElBQUksT0FBTyxJQUFJLENBQUMsVUFBVSxLQUFLLFdBQVcsQ0FBQztJQUM1RSxDQUFDOztnQkFqR3lCLFVBQVU7Z0JBQWdCLE1BQU07O0lBckIvQyxTQUFTO1FBRHJCLFVBQVUsRUFBRTt5Q0FzQmUsVUFBVSxFQUFnQixNQUFNO09BckIvQyxTQUFTLENBdUhyQjtJQUFELGdCQUFDO0NBQUEsQUF2SEQsQ0FBK0IsWUFBWSxHQXVIMUM7U0F2SFksU0FBUyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50RW1pdHRlciwgSW5qZWN0YWJsZSwgTmdab25lLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBSZXF1ZXN0LCBIdHRwUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBLZWVwYWxpdmVTdmMgfSBmcm9tICdAbmctaWRsZS9jb3JlJztcblxuLyoqXG4gKiBBbiBleGFtcGxlIG9mIGFuIGluamVjdGFibGUgc2VydmljZS5cbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEtlZXBhbGl2ZSBleHRlbmRzIEtlZXBhbGl2ZVN2YyBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgcGluZ1JlcXVlc3Q6IEh0dHBSZXF1ZXN0PGFueT47XG4gIHByaXZhdGUgcGluZ0ludGVydmFsOiBudW1iZXIgPSAxMCAqIDYwO1xuICBwcml2YXRlIHBpbmdIYW5kbGU6IGFueTtcblxuICAvKlxuICAgKiBBbiBldmVudCBlbWl0dGVkIHdoZW4gdGhlIHNlcnZpY2UgaXMgcGluZ2luZy5cbiAgICovXG4gIHB1YmxpYyBvblBpbmc6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qXG4gICAqIEFuIGV2ZW50IGVtaXR0ZWQgd2hlbiB0aGUgc2VydmljZSBoYXMgcGluZ2VkIGFuIEhUVFAgZW5kcG9pbnQgYW5kIHJlY2VpdmVkIGEgcmVzcG9uc2UuXG4gICAqL1xuICBwdWJsaWMgb25QaW5nUmVzcG9uc2U6IEV2ZW50RW1pdHRlcjxIdHRwUmVzcG9uc2U8YW55Pj4gPSBuZXcgRXZlbnRFbWl0dGVyPFxuICAgIEh0dHBSZXNwb25zZTxhbnk+XG4gID4oKTtcblxuICAvKlxuICAgKiBJbml0aWFsaXplcyBhIG5ldyBpbnN0YW5jZSBvZiBLZWVwYWxpdmVcbiAgICogQHBhcmFtIGh0dHAgLSBUaGUgSFRUUCBzZXJ2aWNlLlxuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LCBwcml2YXRlIHpvbmU6IE5nWm9uZSkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICAvKlxuICAgKiBTZXRzIHRoZSBzdHJpbmcgb3IgUmVxdWVzdCB0aGF0IHNob3VsZCBiZSB1c2VkIHdoZW4gcGluZ2luZy5cbiAgICogQHBhcmFtIHVybCAtIFRoZSBVUkwgb3IgUmVxdWVzdCBvYmplY3QgdG8gdXNlIHdoZW4gcGluZ2luZy5cbiAgICogQHJldHVybiBUaGUgY3VycmVudCBSZXF1ZXN0IHVzZWQgd2hlbiBwaW5naW5nLlxuICAgKi9cbiAgcmVxdWVzdDxUPih1cmw/OiBzdHJpbmcgfCBIdHRwUmVxdWVzdDxUPik6IEh0dHBSZXF1ZXN0PFQ+IHtcbiAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHRoaXMucGluZ1JlcXVlc3QgPSBuZXcgSHR0cFJlcXVlc3Q8VD4oJ0dFVCcsIHVybCk7XG4gICAgfSBlbHNlIGlmICh1cmwgaW5zdGFuY2VvZiBIdHRwUmVxdWVzdCkge1xuICAgICAgdGhpcy5waW5nUmVxdWVzdCA9IHVybDtcbiAgICB9IGVsc2UgaWYgKHVybCA9PT0gbnVsbCkge1xuICAgICAgdGhpcy5waW5nUmVxdWVzdCA9IG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMucGluZ1JlcXVlc3Q7XG4gIH1cblxuICAvKlxuICAgKiBTZXRzIHRoZSBpbnRlcnZhbCAoaW4gc2Vjb25kcykgYXQgd2hpY2ggdGhlIHBpbmcgb3BlcmF0aW9uIHdpbGwgb2NjdXIgd2hlbiBzdGFydCgpIGlzIGNhbGxlZC5cbiAgICogQHBhcmFtIHNlY29uZHMgLSBUaGUgcGluZyBpbnRlcnZhbCBpbiBzZWNvbmRzLlxuICAgKiBAcmV0dXJuIFRoZSBjdXJyZW50IGludGVydmFsIHZhbHVlLlxuICAgKi9cbiAgaW50ZXJ2YWwoc2Vjb25kcz86IG51bWJlcik6IG51bWJlciB7XG4gICAgaWYgKCFpc05hTihzZWNvbmRzKSAmJiBzZWNvbmRzID4gMCkge1xuICAgICAgdGhpcy5waW5nSW50ZXJ2YWwgPSBzZWNvbmRzO1xuICAgIH0gZWxzZSBpZiAoIWlzTmFOKHNlY29uZHMpICYmIHNlY29uZHMgPD0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnRlcnZhbCB2YWx1ZSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvLicpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnBpbmdJbnRlcnZhbDtcbiAgfVxuXG4gIC8qXG4gICAqIEltbWVkaWF0ZWx5IHBlcmZvcm1zIHRoZSBwaW5nIG9wZXJhdGlvbi4gSWYgYSByZXF1ZXN0IGhhcyBiZWVuIHNldCwgYW4gSFRUUFxuICAgKiByZXF1ZXN0IHdpbGwgYmUgbWFkZSBhbmQgdGhlIHJlc3BvbnNlIHdpbGwgYmUgZW1pdHRlZCB2aWEgdGhlXG4gICAqIG9uUGluZ1Jlc3BvbnNlIGV2ZW50LlxuICAgKi9cbiAgcGluZygpOiB2b2lkIHtcbiAgICB0aGlzLm9uUGluZy5lbWl0KG51bGwpO1xuICAgIGlmICh0aGlzLnBpbmdSZXF1ZXN0KSB7XG4gICAgICB0aGlzLmh0dHAucmVxdWVzdCh0aGlzLnBpbmdSZXF1ZXN0KS5zdWJzY3JpYmUoXG4gICAgICAgIChyZXNwb25zZTogSHR0cFJlc3BvbnNlPGFueT4pID0+IHtcbiAgICAgICAgICB0aGlzLm9uUGluZ1Jlc3BvbnNlLmVtaXQocmVzcG9uc2UpO1xuICAgICAgICB9LFxuICAgICAgICAoZXJyb3I6IEh0dHBSZXNwb25zZTxhbnk+KSA9PiB7XG4gICAgICAgICAgdGhpcy5vblBpbmdSZXNwb25zZS5lbWl0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiBTdGFydHMgcGluZ2luZyBvbiBhbiBpbnRlcnZhbC5cbiAgICovXG4gIHN0YXJ0KCk6IHZvaWQge1xuICAgIHRoaXMuc3RvcCgpO1xuXG4gICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIHRoaXMucGluZ0hhbmRsZSA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgdGhpcy5waW5nKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSwgdGhpcy5waW5nSW50ZXJ2YWwgKiAxMDAwKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qXG4gICAqIFN0b3BzIHBpbmdpbmcgb24gYW4gaW50ZXJ2YWwuXG4gICAqL1xuICBzdG9wKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhc1BpbmdIYW5kbGUoKSkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnBpbmdIYW5kbGUpO1xuICAgICAgdGhpcy5waW5nSGFuZGxlID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiBQZXJmb3JtcyBhbnkgY2xlYW51cCB0YXNrcyB3aGVuIEFuZ3VsYXIgZGVzdHJveXMgdGhlIGluc3RhbmNlLlxuICAgKi9cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5zdG9wKCk7XG4gIH1cblxuICAvKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBzZXJ2aWNlIHdpbGwgcGluZyBhdXRvbWF0aWNhbGx5IGF0IHRoZSBzcGVjaWZpZWQgaW50ZXJ2YWwuXG4gICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2VydmljZSB3aWxsIHBpbmcgYXQgdGhlIHNwZWNpZmllZCBpbnRlcnZhbDsgb3RoZXJ3aXNlLCBmYWxzZS5cbiAgICovXG4gIGlzUnVubmluZygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5oYXNQaW5nSGFuZGxlKCk7XG4gIH1cblxuICBwcml2YXRlIGhhc1BpbmdIYW5kbGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMucGluZ0hhbmRsZSAhPT0gbnVsbCAmJiB0eXBlb2YgdGhpcy5waW5nSGFuZGxlICE9PSAndW5kZWZpbmVkJztcbiAgfVxufVxuIl19